% extends "base.html"

{% block title %}${vocab.labelgetter(thing)}{% endblock %}

{% block bodyattrs %}vocab="http://schema.org/" id="thing"{% endblock %}
{% block navcontainerclass %} container {% endblock %}

% block scripts
  <script src="/vendor/jquery/js/jquery.js"></script>
  <script src="/js/vocabloader.js"></script>
  <script src="/js/thing.js"></script>
% endblock

{% block navpath %}
  <li><a href="${url_for('thingview.listview')}">Saker</a></li>
  <li class="active"><a>${self.title()}</a></li>
{% endblock %}

% block content

  <div class="row">
    <div class="col-md-9">
      ${viewthing(thing, element='article', classes='panel panel-default main-item')}
    </div>
    % if not rel and thing[REVERSE]
      <div class="col-md-3 side-view">
        <h4>${ui[REVERSE].label}</h4>
        <p>
          <a href="${url_for('.find', o=thing[ID], limit=page_limit)}">${ui.SEE_ALL.label}&hellip;</a>
        </p>
        <dl resource="${thing[ID]}">
          % for k, vs in thing[REVERSE].items()
            % set p = vocab.index[k] or {'curie': k}
          <dt>Med relation: ${termref(p)}</dt>
          <dd>
              % for v in vs
                ${viewthing(v, rev=p.curie)}
              % endfor
          </dd>
          % endfor
        </dl>
      </div>
    % endif
  </div>
% endblock

% macro viewthing(thing, element='div', classes='panel panel-default', rel=None, rev=None)
  % set thing_id = thing[ID]
  % set typename = thing[TYPE]
  % if isinstance(typename, list)
    % set t = vocab.index[typename[0]] or vocab.index[typename[1]] or {}
  % else
    % set t = vocab.index[typename] or {}
  % endif
  % set as_chip = rev or (rel and 'quotedFromGraph' in thing or len(thing) < 2)
  <${element} class="${classes}{% if as_chip%} link-item{% endif %}"

      {% if rel %} property="${rel}"{% endif %}
      {% if rev %} rev="${rev}"{% endif %}
      {% if ID in thing %} resource="${thing_id}"{% endif %}
      {% if t.curie %} typeof="${t.curie}"{% endif %}>

    % if ID in thing
      <header class="panel-heading">
          % if thing_id.startswith(('http:', 'https:')) or '?' in thing_id
            % set thing_url = view_url(thing_id)
          % elif thing_id.startswith('/def/terms#')
            % set thing_url = url_for('thingview.termview', term=thing_id.split('#', 1)[-1])
          % else
            % set thing_url = url_for('thingview.thingview', path=thing_id[1:], suffix='html')
          % endif
          % if t
            ${termref(t, classes='', labeltype='label-class')}
          % endif
        <a href="${thing_url}" class="thing-id">
          <small><code>&lt;${thing_id}&gt;</code></small>
        </a>
        <h1 class="panel-title">
          <a href="${thing_url}" class="thing-label">
            ${ldview.getlabel(thing)}
          </a>
        </h1>
      </header>
    % endif

    % if not as_chip
      <div class="panel-body">
        <dl class="{% if not rel %}dl-horizontal{% endif %}">

          {#
          % if ID in thing
            <dt>${ui[ID].label}</dt>
            <dd>
              <a href="${url_for('thingview.thingview', path=thing_id[1:], suffix='html')}"
                 ><code>&lt;${thing_id}&gt;</code></a>
            </dd>
          %endif
          % if typename
            <dt>${ui[TYPE].label}</dt>
            <dd>
              % if t
                <a href="${url_for('thingview.termview', term=t.curie)}"
                  class="label label-primary">${t.label or t.curie}</a>
              % else
                ${typename}
              % endif
            </dd>
          %endif
          #}

          % for k in vocab.sortedkeys(thing)
            % set v = thing[k]
            % if (k in vocab.index or k != REVERSE) and not isinstance(v, dict) or len(v) > 3
              % set p = vocab.index[k] or {'curie': k}
              {% if loop.index > 1 %}<hr/>{% endif %}
              <dt>
                ${termref(p)}
              </dt>
              <dd>
                % if k == ID and v[0] != '_'
                  % if v.startswith(('http:', 'https:'))
                    <a href="${view_url(v)}">&lt;${v}&gt;</a>
                  % else
                    <a href="${url_for('thingview.thingview', path=v[1:], suffix='html')}">&lt;${v}&gt;</a>
                  % endif
                % elif isinstance(v, dict) and len(v) > 2
                  ${viewthing(v, rel=k)}
                % elif isinstance(v, list)
                  <ul>
                    % for sub in v
                      <li>
                        % if isinstance(sub, dict)
                          ${viewthing(sub, rel=k)}
                        % else
                        <span {% if p.curie %} property="${p.curie}"{% endif %}>${sub}</span>
                        % endif
                      </li>
                    % endfor
                  </ul>
                % else
                  <span {% if p.curie %} property="${p.curie}"{% endif %}>${v}</span>
                % endif
              </dd>
            % endif
          % endfor

        </dl>
      </div>
    % endif

  </${element}>
% endmacro

% macro termref(term, classes='', labeltype='')
  % set label = term.curie
  % if term.label
    % set label = term.label[0].upper() + term.label[1:]
  % endif
  % if term.curie
    <a href="/vocabview/#${term.curie}" class="${labeltype}"><span
        class="${classes}">${label}</span></a>
  % elif term.label
    ${label}
  % else
    <code>${term.curie}</code>
  % endif
% endmacro

% block footer
  <nav class="navbar navbar-default" role="navigation">
    <p class="navbar-text">Other formats:</p>
    <ul class="nav nav-pills">
      <li>
        <a href="${data_url('jsonld')}">JSON-LD</a>
      </li>
      <li>
        <a href="${data_url('ttl')}">Turtle</a>
      </li>
      <li>
        <a href="${data_url('rdf')}">RDF/XML</a>
      </li>
    </ul>
  </nav>
% endblock
