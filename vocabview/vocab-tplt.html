<!DOCTYPE html>
<html>
  % set vocabs = union(set(graph.subjects(RDF.type, OWL.Ontology)),
                  set(graph.objects(RDFS.isDefinedBy)))
  <head>
    <meta charset="utf-8" />
    <title>${graph.label(list(vocabs)[0])} - Vocab View</title>
    <link rel="stylesheet" href="vocab.css" />
    <link rel="stylesheet" href="graph.css" />
  </head>
  <body>
    % set rclasses = map(graph.resource, sorted(
                  union(set((graph.subjects(RDF.type, RDFS.Class))),
                    set((graph.subjects(RDF.type, OWL.Class))))))
    % set rproperties = map(graph.resource, sorted(
                  union(set(graph.subjects(RDF.type, RDF.Property)),
                    set(graph.subjects(RDF.type, OWL.ObjectProperty)),
                    set(graph.subjects(RDF.type, OWL.DatatypeProperty)))
                ))
    % set DOMAIN = union(SCHEMA.domainIncludes, RDFS.domain)
    % set RANGE = union(SCHEMA.rangeIncludes, RDFS.range)
    <nav>
      <section>
        <b>Classes</b>
        % for rclass in rclasses
        <a href="${link(rclass)}">${rclass.qname()}</a>
        % endfor
      </section>
      <section>
        <b>Properties</b>
        % for rprop in rproperties
        <a href="${link(rprop)}">${rprop.qname()}</a>
        % endfor
      </section>
    </nav>

    <header>
    % for vocab in vocabs
      <h1><a href="${vocab}">
          ${graph.value(vocab, union(DC.title, RDFS.label)) or "&lt;%s>" % vocab}</a>
      </h1>
      <p>${graph.value(vocab, union(DC.description, RDFS.comment))}</p>
    % endfor
    </header>

    <section>
      <h1>Classes</h1>
      % for rclass in rclasses
      <div id="${rclass.qname()}" class="class">
        <h2><code>${rclass.qname()}</code></h2>
        <p>
          ${(label(rclass))}
          % if rclass.value(RDFS.comment)
            <em>&mdash; ${(rclass.value(RDFS.comment))}</em>
          % endif
        </p>
        <dl>
          <dt>base-classes</dt>
          <dd>
            <ul class="baseclasses">
              % for c in sorted(rclass.objects(union(RDFS.subClassOf, OWL.equivalentClass)))
                % if isinstance(c.identifier, URIRef)
                  <li class="${listclass(c)}">
                    <a href="${link(c)}">${c.qname()}</a>
                  </li>
                % endif
              % endfor
            </ul>
          </dd>
          <dt>sub-classes</dt>
          <dd>
          <ul class="subclasses">
              % for c in sorted(rclass.subjects(union(RDFS.subClassOf, OWL.equivalentClass)))
              <li class="${listclass(c)}"><a href="${link(c)}">${c.qname()}</a></li>
              % endfor
            </ul>
          </dd>
          <dt>properties</dt>
          <dd>
            <ul class="properties">
              % for prop in sorted(rclass.subjects(DOMAIN))
              <li class="${listclass(prop)}">
                <a href="${link(prop)}"><code>${prop.qname()}</code></a>
                % if prop.value(SKOS.notation)
                <span>(${prop.value(SKOS.notation)})</span>
                % endif
                <i>${(label(prop))}</i>
                % set _range = prop.value(RANGE)
                % if _range
                <span>&rarr; <a href="${link(_range)}">${_range.qname()}</a></span>
                % endif
                <!--!
                % for g in prop.objects(VANN.termGroup)
                <i><a href="${link(g)}">${g.qname()}</a></i>
                % endfor
                -->
              </li>
              % endfor
            </ul>
          </dd>
          <dt>in range of properties</dt>
          <dd>
          <dd>
            <ul class="properties range-of">
              % for prop in sorted(rclass.subjects(RANGE))
              <li class="${listclass(prop)}">
                &larr; <a href="${link(prop)}"><code>${prop.qname()}</code></a>
                % set domain = prop.value(DOMAIN)
                % if domain
                <span>&larr; <a href="${link(domain)}">${domain.qname()}</a></span>
                % endif
              </li>
            % endfor
          </dd>
          % if any(rclass.subjects(RDF.type))
          <dt>instances</dt>
          <dd>
          <ul class="instances">
              % for i in sorted(rclass.subjects(RDF.type))
              <li><a href="${link(i)}">${i.qname()}</a></li>
              % endfor
            </ul>
          </dd>
          % endif
        </dl>
      </div>
      % endfor
    </section>

    <section>
      <h1>Properties</h1>
      % for rprop in rproperties
      <div id="${rprop.qname()}" class="property">
        <h2><code>${rprop.qname()}</code></h2>
        <p>
          ${(label(rprop))}
          % if rprop.value(RDFS.comment)
            <em>&mdash; ${(rprop.value(RDFS.comment))}</em>
          % endif
        </p>
        <dl>
          <dt>base-properties</dt>
          <dd>
            <ul class="baseproperties">
              % for p in sorted(rprop.objects(union(RDFS.subPropertyOf, OWL.equivalentProperty)))
              <li class="${listclass(p)}">
                <a href="${link(p)}">${p.qname()}</a>
              </li>
              % endfor
            </ul>
          </dd>
          <dt>sub-properties</dt>
          <dd>
          <ul class="subproperties">
              % for p in sorted(rprop.subjects(union(RDFS.subPropertyOf, OWL.equivalentProperty)))
              <li class="${listclass(p)}">
                <a href="${link(p)}">${p.qname()}</a>
              </li>
              % endfor
            </ul>
          </dd>
          <dt>domain(s)</dt>
          <dd>
            <ul>
              % for c in sorted(rprop.objects(DOMAIN))
              <li class="${listclass(c)}">
                <a href="${link(c)}"><code>${c.qname()}</code></a>
                <i>${(label(c))}</i>
              </li>
              % endfor
            </ul>
          </dd>
          <dt>range(s)</dt>
          <dd>
            <ul>
              % for c in sorted(rprop.objects(RANGE))
              <li class="${listclass(c)}">
                <a href="${link(c)}"><code>${c.qname()}</code></a>
                <i>${(label(c))}</i>
              </li>
              % endfor
            </ul>
          </dd>
        </dl>
      </div>
      % endfor
    </section>

    <script src="d3.v3.min.js"></script>
    <script src="graph.js"></script>
    <script src="vocab.js"></script>
  </body>
</html>
